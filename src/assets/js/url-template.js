var uritemplate=function(){function k(a){this.raw=a;this.cache={}}function t(a){this.set=a}function q(a){this.txt=a}function l(a){return encodeURIComponent(a).replace(x,function(a){return escape(a)})}function u(a){return encodeURI(a)}function m(a,b,c){return b+(0<b.length?"\x3d":"")+c}function v(a,b,c,d){d&&(a="");b&&0!==b.length||(b=a);return b+(0<b.length?"\x3d":"")+c}function n(a,b){for(var c in a)this[c]=a[c];this.vars=b}function h(a){this.str="";a===w?this.appender=h.UnboundAppend:(this.len=
0,this.limit=a,this.appender=h.BoundAppend)}function y(a,b,c,d,f){if(c.isArr){var e=new h(a.maxLength);a="";var g=b.length;for(c=0;c<g;c++)null!==b[c]&&void 0!==b[c]&&(e.append(a).append(b[c],d),a=",");b=e.str}else if(c.isObj){a=new h(a.maxLength);c="";for(e in b)b.hasOwnProperty(e)&&null!==b[e]&&void 0!==b[e]&&(a.append(c+e+",").append(b[e],d),c=",");b=a.str}else b=(new h(a.maxLength)).append(b,d).str;f("",b)}function z(a,b,c,d,f){if(c.isArr)for(c=b.length,a=0;a<c;a++)f("",d(b[a]));else if(c.isObj)for(var e in b)b.hasOwnProperty(e)&&
f(e,d(b[e]));else f("",d(b))}function p(a,b,c){this.name=unescape(a);this.valueHandler=b;this.maxLength=c}k.prototype.get=function(a){var b=this.lookupRaw(a),c=b;"function"==typeof b&&(c=this.cache[a],null!==c&&void 0!==c?c=c.val:(c=b(this.raw),this.cache[a]={key:a,val:c}));return c};k.prototype.lookupRaw=function(a){return k.lookup(this,this.raw,a)};k.lookup=function(a,b,c){var d=b[c];if(void 0!==d)return d;c=c.split(".");for(var f=c.length-1,d=0;d<f;d++){var e=c.slice(0,f-d).join("."),g=c.slice(-d-
1).join("."),e=b[e];if(void 0!==e)return k.lookup(a,e,g)}};t.prototype.expand=function(a){a=new k(a);var b="",c,d=this.set.length;for(c=0;c<d;c++)b+=this.set[c].expand(a);return b};q.prototype.expand=function(){return this.txt};var x=/[:/?#\[\]@!$&()*+,;=']/g,A={prefix:"",joiner:",",encode:l,builder:m},B={prefix:"",joiner:",",encode:u,builder:m},C={prefix:"#",joiner:",",encode:u,builder:m},D={prefix:";",joiner:";",encode:l,builder:function(a,b,c,d){d&&(a="");b&&0!==b.length||(b=a);return b+(0<b.length&&
c?"\x3d":"")+c}},E={prefix:"?",joiner:"\x26",encode:l,builder:v},F={prefix:"\x26",joiner:"\x26",encode:l,builder:v},G={prefix:"/",joiner:"/",encode:l,builder:m},H={prefix:".",joiner:".",encode:l,builder:m};n.build=function(a,b){switch(a){case "":a=A;break;case "+":a=B;break;case "#":a=C;break;case ";":a=D;break;case "?":a=E;break;case "\x26":a=F;break;case "/":a=G;break;case ".":a=H;break;default:throw"Unexpected operator: '"+a+"'";}return new n(a,b)};n.prototype.expand=function(a){for(var b=this.prefix,
c=this.joiner,d=this.builder,f="",e=0,g=this.vars.length,e=0;e<g;e++){var h=this.vars[e];h.addValues(a,this.encode,function(a,e,g){a=d(h.name,a,e,g);null!==a&&void 0!==a&&(f+=b+a,b=c)})}return f};var w={};h.prototype.append=function(a,b){return this.appender(this,a,b)};h.UnboundAppend=function(a,b,c){b=c?c(b):b;a.str+=b;return a};h.BoundAppend=function(a,b,c){b=b.substring(0,a.limit-a.len);a.len+=b.length;b=c?c(b):b;a.str+=b;return a};p.build=function(a,b,c,d){b=b?z:y;c||(d=w);return new p(a,b,d)};
p.prototype.addValues=function(a,b,c){a=a.get(this.name);var d,f=!1,e=!1,g=!0;if(null!==a&&void 0!==a&&(f=a.constructor===Array,e=a.constructor===Object,!(g=f&&0===a.length)&&(g=e)))a:{for(d in a){g=!1;break a}g=!0}d={isArr:f,isObj:e,isUndef:g};d.isUndef||this.valueHandler(this,a,d,b,c)};var I=/([^*:]*)((\*)|(:)([0-9]+))?/,r=/(\{([+#.;?&\/])?(([^.*:,{}|@!=$()][^*:,{}$()]*)(\*|:([0-9]+))?(,([^.*:,{}][^*:,{}]*)(\*|:([0-9]+))?)*)\})/g,J=function(a){var b=a[2]||"";a=a[3].split(",");var c,d=a.length;for(c=
0;c<d;c++){var f;if(null===(f=a[c].match(I)))throw"unexpected parse error in varspec: "+a[c];var e=c,g;g=f[1];var h=f[3],k=f[4];f=parseInt(f[5],10);g=p.build(g,h,k,f);a[e]=g}return n.build(b,a)};return function(a){var b=0,c=[],d;for(r.lastIndex=0;null!==(d=r.exec(a));){var f=d.index,e=c;b<f&&(b=a.substr(b,f-b),e.push(new q(b)));c.push(J(d));b=r.lastIndex}d=a.length;b<d&&(a=a.substr(b,d-b),c.push(new q(a)));return new t(c)}}();